"use strict";(self.webpackChunkneoforged_docs=self.webpackChunkneoforged_docs||[]).push([[3959],{7618:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var a=t(5893),r=t(1151);const i={},o="Registering Payloads",s={id:"networking/payload",title:"Registering Payloads",description:"Payloads are a way to send arbitrary data between the client and the server. They are registered using the IPayloadRegistrar that can be retrieved for a given namespace from the RegisterPayloadHandlerEvent event.",source:"@site/versioned_docs/version-1.20.4/networking/payload.md",sourceDirName:"networking",slug:"/networking/payload",permalink:"/Neoforge-Korean-Documentation/en/docs/1.20.4/networking/payload",draft:!1,unlisted:!1,tags:[],version:"1.20.4",frontMatter:{},sidebar:"mainSidebar",previous:{title:"Entities",permalink:"/Neoforge-Korean-Documentation/en/docs/1.20.4/networking/entities"},next:{title:"Resources",permalink:"/Neoforge-Korean-Documentation/en/docs/1.20.4/resources/"}},d={},l=[];function c(e){const n={a:"a",code:"code",h1:"h1",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"registering-payloads",children:"Registering Payloads"}),"\n",(0,a.jsxs)(n.p,{children:["Payloads are a way to send arbitrary data between the client and the server. They are registered using the ",(0,a.jsx)(n.code,{children:"IPayloadRegistrar"})," that can be retrieved for a given namespace from the ",(0,a.jsx)(n.code,{children:"RegisterPayloadHandlerEvent"})," event."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@SubscribeEvent\npublic static void register(final RegisterPayloadHandlerEvent event) {\n    final IPayloadRegistrar registrar = event.registrar("mymod");\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"Assuming we want to send the following data:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"public record MyData(String name, int age) {}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Then we can implement the ",(0,a.jsx)(n.code,{children:"CustomPacketPayload"})," interface to create a payload that can be used to send and receive this data."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'public record MyData(String name, int age) implements CustomPacketPayload {\n    \n    public static final ResourceLocation ID = new ResourceLocation("mymod", "my_data");\n    \n    public MyData(final FriendlyByteBuf buffer) {\n        this(buffer.readUtf(), buffer.readInt());\n    }\n    \n    @Override\n    public void write(final FriendlyByteBuf buffer) {\n        buffer.writeUtf(name());\n        buffer.writeInt(age());\n    }\n    \n    @Override\n    public ResourceLocation id() {\n        return ID;\n    }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["As you can see from the example above the ",(0,a.jsx)(n.code,{children:"CustomPacketPayload"})," interface requires us to implement the ",(0,a.jsx)(n.code,{children:"write"})," and ",(0,a.jsx)(n.code,{children:"id"})," methods. The ",(0,a.jsx)(n.code,{children:"write"})," method is responsible for writing the data to the buffer, and the ",(0,a.jsx)(n.code,{children:"id"})," method is responsible for returning a unique identifier for this payload.\nWe then also need a reader to register this later on, here we can use a custom constructor to read the data from the buffer."]}),"\n",(0,a.jsx)(n.p,{children:"Finally, we can register this payload with the registrar:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@SubscribeEvent\npublic static void register(final RegisterPayloadHandlerEvent event) {\n    final IPayloadRegistrar registrar = event.registrar("mymod");\n    registrar.play(MyData.ID, MyData::new, handler -> handler\n            .client(ClientPayloadHandler.getInstance()::handleData)\n            .server(ServerPayloadHandler.getInstance()::handleData));\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"Dissecting the code above we can notice a couple of things:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The registrar has a ",(0,a.jsx)(n.code,{children:"play"})," method, that can be used for registering payloads which are send during the play phase of the game.","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Not visible in this code are the methods ",(0,a.jsx)(n.code,{children:"configuration"})," and ",(0,a.jsx)(n.code,{children:"common"}),", however they can also be used to register payloads for the configuration phase. The ",(0,a.jsx)(n.code,{children:"common"})," method can be used to register payloads for both the configuration and play phase simultaneously."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["The constructor of ",(0,a.jsx)(n.code,{children:"MyData"})," is used as a method reference to create a reader for the payload."]}),"\n",(0,a.jsxs)(n.li,{children:["The third argument for the registration method is a callback that can be used to register the handlers for when the payload arrives at either the client or server side.","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The ",(0,a.jsx)(n.code,{children:"client"})," method is used to register a handler for when the payload arrives at the client side."]}),"\n",(0,a.jsxs)(n.li,{children:["The ",(0,a.jsx)(n.code,{children:"server"})," method is used to register a handler for when the payload arrives at the server side."]}),"\n",(0,a.jsxs)(n.li,{children:["There is additionally a secondary registration method ",(0,a.jsx)(n.code,{children:"play"})," on the registrar itself that accepts a handler for both the client and server side, this can be used to register a handler for both sides at once."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Now that we have registered the payload we need to implement a handler.\nFor this example we will specifically take a look at the client side handler, however the server side handler is very similar."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'public class ClientPayloadHandler {\n    \n    private static final ClientPayloadHandler INSTANCE = new ClientPayloadHandler();\n    \n    public static ClientPayloadHandler getInstance() {\n        return INSTANCE;\n    }\n    \n    public void handleData(final MyData data, final PlayPayloadContext context) {\n        // Do something with the data, on the network thread\n        blah(data.name());\n        \n        // Do something with the data, on the main thread\n        context.workHandler().submitAsync(() -> {\n            blah(data.age());\n        })\n        .exceptionally(e -> {\n            // Handle exception\n            context.packetHandler().disconnect(Component.translatable("my_mod.networking.failed", e.getMessage()));\n            return null;\n        });\n    }\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"Here a couple of things are of note:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"The handling method here gets the payload, and a contextual object. The contextual object is different for the play and configuration phase, and if you register a common packet, then it will need to accept the super type of both contexts."}),"\n",(0,a.jsx)(n.li,{children:"The handler of the payload method is invoked on the networking thread, so it is important to do all the heavy work here, instead of blocking the main game thread."}),"\n",(0,a.jsxs)(n.li,{children:["If you want to run code on the main game thread you can use the ",(0,a.jsx)(n.code,{children:"workHandler"})," of the context to submit a task to the main thread.","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The ",(0,a.jsx)(n.code,{children:"workHandler"})," will return a ",(0,a.jsx)(n.code,{children:"CompletableFuture"})," that will be completed on the main thread, and can be used to submit tasks to the main thread."]}),"\n",(0,a.jsxs)(n.li,{children:["Notice: A ",(0,a.jsx)(n.code,{children:"CompletableFuture"})," is returned, this means that you can chain multiple tasks together, and handle exceptions in a single place."]}),"\n",(0,a.jsxs)(n.li,{children:["If you do not handle the exception in the ",(0,a.jsx)(n.code,{children:"CompletableFuture"})," then it will be swallowed, ",(0,a.jsx)(n.strong,{children:"and you will not be notified of it"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Now that you know how you can facilitate the communication between the client and the server for your mod, you can start implementing your own payloads.\nWith your own payloads you can then use those to configure the client and server using ",(0,a.jsx)(n.a,{href:"/Neoforge-Korean-Documentation/en/docs/1.20.4/networking/configuration-tasks",children:"Configuration Tasks"})]})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>s,a:()=>o});var a=t(7294);const r={},i=a.createContext(r);function o(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);